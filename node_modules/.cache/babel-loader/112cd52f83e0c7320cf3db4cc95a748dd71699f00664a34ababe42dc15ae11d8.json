{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";const KakaoMap=_ref=>{let{records=[]}=_ref;const mapRef=useRef(null);const markersRef=useRef([]);const geocoderRef=useRef(null);const[ready,setReady]=useState(false);// ✅ 초기화 완료 여부\nuseEffect(()=>{const initMap=()=>{const container=document.getElementById('map');if(!container)return;const map=new window.kakao.maps.Map(container,{center:new window.kakao.maps.LatLng(36.5,127.5),level:12});mapRef.current=map;geocoderRef.current=new window.kakao.maps.services.Geocoder();setReady(true);// ✅ 지도 + 지오코더 초기화 완료\n};if(!window.kakao||!window.kakao.maps){const script=document.createElement('script');script.src='//dapi.kakao.com/v2/maps/sdk.js?appkey=eb46d70dcce4c3347f6e67a7afcfa896&autoload=false&libraries=services';script.async=true;script.onload=()=>window.kakao.maps.load(initMap);document.head.appendChild(script);}else{window.kakao.maps.load(initMap);}},[]);useEffect(()=>{if(!ready||!mapRef.current||!geocoderRef.current)return;const map=mapRef.current;const geocoder=geocoderRef.current;const bounds=new window.kakao.maps.LatLngBounds();// ✅ 중복 주소 제거\nconst uniqueRecords=Array.from(new Map(records.map(r=>[r.address,r])).values());// 이전 마커 제거\nmarkersRef.current.forEach(marker=>marker.setMap(null));markersRef.current=[];const geocodePromises=uniqueRecords.map(record=>{return new Promise(resolve=>{var _record$address;const address=(_record$address=record.address)===null||_record$address===void 0?void 0:_record$address.trim();if(!address)return resolve(null);geocoder.addressSearch(address,(result,status)=>{if(status===window.kakao.maps.services.Status.OK){const coords=new window.kakao.maps.LatLng(result[0].y,result[0].x);const marker=new window.kakao.maps.Marker({map,position:coords});markersRef.current.push(marker);bounds.extend(coords);resolve(coords);}else{console.warn(\"❌ 주소 검색 실패:\",address);resolve(null);}});});});Promise.all(geocodePromises).then(results=>{const valid=results.filter(r=>r!==null);console.log(\"✅ 마커 찍힌 개수:\",valid.length);if(valid.length>0){map.setBounds(bounds);}});},[records,ready]);// ✅ ready 의존성 추가\nreturn/*#__PURE__*/_jsx(\"div\",{id:\"map\",style:{width:'100%',height:'500px'}});};export default KakaoMap;","map":{"version":3,"names":["React","useEffect","useRef","useState","jsx","_jsx","KakaoMap","_ref","records","mapRef","markersRef","geocoderRef","ready","setReady","initMap","container","document","getElementById","map","window","kakao","maps","Map","center","LatLng","level","current","services","Geocoder","script","createElement","src","async","onload","load","head","appendChild","geocoder","bounds","LatLngBounds","uniqueRecords","Array","from","r","address","values","forEach","marker","setMap","geocodePromises","record","Promise","resolve","_record$address","trim","addressSearch","result","status","Status","OK","coords","y","x","Marker","position","push","extend","console","warn","all","then","results","valid","filter","log","length","setBounds","id","style","width","height"],"sources":["C:/Users/user/Desktop/my-blog-record-app/src/components/KakaoMap.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\n\r\nconst KakaoMap = ({ records = [] }) => {\r\n  const mapRef = useRef(null);\r\n  const markersRef = useRef([]);\r\n  const geocoderRef = useRef(null);\r\n  const [ready, setReady] = useState(false); // ✅ 초기화 완료 여부\r\n\r\n  useEffect(() => {\r\n    const initMap = () => {\r\n      const container = document.getElementById('map');\r\n      if (!container) return;\r\n\r\n      const map = new window.kakao.maps.Map(container, {\r\n        center: new window.kakao.maps.LatLng(36.5, 127.5),\r\n        level: 12,\r\n      });\r\n\r\n      mapRef.current = map;\r\n      geocoderRef.current = new window.kakao.maps.services.Geocoder();\r\n      setReady(true); // ✅ 지도 + 지오코더 초기화 완료\r\n    };\r\n\r\n    if (!window.kakao || !window.kakao.maps) {\r\n      const script = document.createElement('script');\r\n      script.src =\r\n        '//dapi.kakao.com/v2/maps/sdk.js?appkey=eb46d70dcce4c3347f6e67a7afcfa896&autoload=false&libraries=services';\r\n      script.async = true;\r\n      script.onload = () => window.kakao.maps.load(initMap);\r\n      document.head.appendChild(script);\r\n    } else {\r\n      window.kakao.maps.load(initMap);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (!ready || !mapRef.current || !geocoderRef.current) return;\r\n\r\n    const map = mapRef.current;\r\n    const geocoder = geocoderRef.current;\r\n    const bounds = new window.kakao.maps.LatLngBounds();\r\n\r\n    // ✅ 중복 주소 제거\r\n    const uniqueRecords = Array.from(\r\n      new Map(records.map((r) => [r.address, r])).values()\r\n    );\r\n\r\n    // 이전 마커 제거\r\n    markersRef.current.forEach((marker) => marker.setMap(null));\r\n    markersRef.current = [];\r\n\r\n    const geocodePromises = uniqueRecords.map((record) => {\r\n      return new Promise((resolve) => {\r\n        const address = record.address?.trim();\r\n        if (!address) return resolve(null);\r\n\r\n        geocoder.addressSearch(address, (result, status) => {\r\n          if (status === window.kakao.maps.services.Status.OK) {\r\n            const coords = new window.kakao.maps.LatLng(result[0].y, result[0].x);\r\n            const marker = new window.kakao.maps.Marker({\r\n              map,\r\n              position: coords,\r\n            });\r\n\r\n            markersRef.current.push(marker);\r\n            bounds.extend(coords);\r\n            resolve(coords);\r\n          } else {\r\n            console.warn(\"❌ 주소 검색 실패:\", address);\r\n            resolve(null);\r\n          }\r\n        });\r\n      });\r\n    });\r\n\r\n    Promise.all(geocodePromises).then((results) => {\r\n      const valid = results.filter((r) => r !== null);\r\n      console.log(\"✅ 마커 찍힌 개수:\", valid.length);\r\n\r\n      if (valid.length > 0) {\r\n        map.setBounds(bounds);\r\n      }\r\n    });\r\n  }, [records, ready]); // ✅ ready 의존성 추가\r\n\r\n  return <div id=\"map\" style={{ width: '100%', height: '500px' }} />;\r\n};\r\n\r\nexport default KakaoMap;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}